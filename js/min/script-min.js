$(function(){function e(){!Modernizr.objectfit&&$(".img-fit").length&&$(".img-fit").each(function(){var e=$(this),a=e.find("img").prop("src");a&&e.css("backgroundImage","url("+a+")").addClass("compat-object-fit")})}function a(){g=$(document).scrollTop(),requestAnimFrame(a),$(".little-squares").length>0&&(TweenMax.set($(".little-squares li:nth-child(even)"),{y:g/8}),TweenMax.set($(".little-squares li:nth-child(odd)"),{y:g/4}))}function t(){function e(){if(l.is(":checked")&&n.find(".active").length){if(void 0!==n.find(".active").attr("data-adjacent")){var e=n.find(".active").attr("data-adjacent").split(","),a=e.length,t=0;for(t;a>t;t++)n.find('[data-department="'+e[t]+'"]').attr("class","department adjacent")}}else if(!l.is(":checked")&&n.find(".adjacent").length){var i;n.find(".active").length&&(i=n.find(".active").attr("data-department")),s.attr("class","department"),i.length&&n.find('[data-department="'+i+'"]').attr("class","department active")}}var a=$("#mapForm"),t=a.find(".map-form"),n=$("#mapFormMetropole"),i=a.find(".map-form-extra"),s=a.find(".department"),o=$("#departement"),l=$("#departement-etendre"),c=a.find("a"),d=a.find(".map-btn"),r=a.find(".btn-metropole");s.on("click",function(a){s.attr("class","department"),$(this).attr("class","department active");var t=$(this).attr("data-department"),n=o.find("option[data-value='"+t+"']");o.val(n.val()),e(l)}),o.on("change",function(t){s.attr("class","department");var n=o.find(":selected").data("value"),i=a.find('[data-department="'+n+'"]');i.length?i.attr("class","department active"):"92"!=n&&"93"!=n&&"94"!=n||a.find('[data-department="75"]').attr("class","department active").siblings().attr("class","department"),e(l)}),l.on("change",function(a){e(l)}),c.on("click",function(e){e.preventDefault(),$(this).parents(".map-btn").length?(d.removeClass("active"),r.addClass("active"),TweenMax.to($($(this).attr("href")),.2,{x:"0%",opacity:1,zIndex:1}),TweenMax.to(n,.2,{x:"-100%",opacity:0,zIndex:0})):(d.addClass("active"),r.removeClass("active"),TweenMax.to(n,.2,{x:"0%",opacity:1,zIndex:1}),TweenMax.to(i,.2,{x:"100%",opacity:0,zIndex:0}))}),u=!0}function n(){if($(".nav-tabs").length){var e=$(".nav-tabs");e.hasClass("nav-tabs-indicator")||(768>m?e.height(0).find(".active").on("click",function(a){var t=0,n=0,i=e.find("li"),s=i.length;for(n;s>n;n++)i.eq(n).hasClass("active")||(t+=i.eq(n).outerHeight());e.height()>0?e.height(0):e.height(t),e.toggleClass("on")}):e.css("height","auto"))}}function i(){$(".news").length&&(TweenMax.set($(".news > li article"),{clearProps:"height"}),$(".news > li article").each(function(e){TweenMax.set($(this),{height:$(this).closest("li").height()+"px"})}))}function s(){$(".popup").addClass("hidden"),$(".bg-popup").addClass("hidden"),$("body").removeClass("wrapper-blured")}function o(){$("#header nav").length&&$("#header nav").removeClass("no-transition"),$("#sidebar-account").length&&$("#sidebar-account").removeClass("no-transition"),$("#sidebar-tools").length&&$("#sidebar-tools").removeClass("no-transition"),$("#sidebar-links").length&&$("#sidebar-links").removeClass("no-transition"),$(".bg-sidebar").length&&$(".bg-sidebar").removeClass("no-transition")}function l(){0==w?$(".prev-slide").hide():$(".prev-slide").show(),w==$("#toSlide li").length-1?$(".next-slide").hide():$(".next-slide").show()}function c(){var e=-$("#toSlide li").eq(0).width()*w;TweenMax.to($("#toSlide li"),.2,{x:e});var a=-$(".lightbox-content ul li").eq(0).width()*w;TweenMax.to($(".lightbox-content ul li"),.2,{x:a})}function d(e,a,t){if($("body,html").css("overflow","hidden"),0==$("#lb").length)if($("main").append('<div id="lb"><div class="black-mask"><button class="close-btn icon-cross"></button></div><button class="prev-slide"></button><button class="next-slide"></button><div class="lightbox-content"></div></div>'),a&&""==t&&$(".lightbox-content").html("<ul><li><img src='"+e+"' /></li></ul>"),a&&""!=t){if(""!=t&&$(t+" li").length>0){$(".lightbox-content").html("<ul></ul>"),$(t+" a").each(function(e,a){$(".lightbox-content ul").append("<li><img src='"+$(this).attr("href")+"' /></li>")}),$(".lightbox-content ul li").each(function(e,a){$(this).css("left",e*$(this).width()-1)});var n=-$(".lightbox-content ul li").eq(0).width()*w;TweenMax.set($(".lightbox-content ul li"),{x:n}),l(),$("#lb .prev-slide").click(function(e){w--,l(),c()}),$("#lb .next-slide").click(function(e){w++,l(),c()})}var i=new Hammer(document.getElementById("lb"));i.on("swipeleft",function(e){w<$("#toSlide li").length-1&&(w++,l(),c())}),i.on("swiperight",function(e){w>0&&(w--,l(),c())})}else $(".lightbox-content").load(e+" .lightbox-content");$("#lb").addClass("on"),$(".black-mask").on("click",r),$(".close-btn").on("click",r)}function r(e){$("#lb").remove(),$("body,html").css("overflow","auto")}function h(e){"undefined"!=typeof U&&U.setMap(null);var a=!1,t;"edit"==$("#map-canvas").attr("data-mode")?a=!0:t={url:"layoutImg/pin@2x.png",scaledSize:new google.maps.Size(45,39),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(12,38)},U=new google.maps.Marker({map:Q,position:e,icon:t,draggable:a,raiseOnDrag:a}),U.addListener("dragend",function(e){var a=e.latLng.lat(),t=e.latLng.lng(),n=new google.maps.LatLng(a,t);O.val(a),R.val(t),p(n)})}function p(e){W.geocode({latLng:e},function(e,a){if(a!=google.maps.GeocoderStatus.OK)return void console.log("Geocoder failed due to: "+a);if(!e[0])return void console.log("No results found");var t=e[0];$("#geolocalisation").val(t.formatted_address)})}var g,v=600,f=$(window).height(),m=$(window).width(),u=!1,b,C=$("body"),w=0;if(window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}(),jQuery.fn.toggleAttr=function(e){return this.each(function(){var a=$(this);a.attr(e)?a.removeAttr(e):a.attr(e,e)})},e(),i(),$(".social-footer").length&&$(".social-footer").addClass("closed").hover(function(){$(this).hasClass("closed")&&TweenMax.set($(this),{className:"-=closed"})},function(){var e=$(document).scrollTop();g+$(window).height()!=$(document).height()&&TweenMax.set($(this),{className:"+=closed"})}),$(".choices").length){var k=$(".choices"),x=k.find(".btn-choice"),y=k.find(".visuel"),q=k.find("li").length,T=0,M=4,L=5,D=200,S=200,z=new SteppedEase(M-1),A=[];for(T;q>T;T++){var I=0,F=y.eq(T);for(A[T]=new TimelineMax({paused:!0}),I;L>I;I++)A[T].add(TweenMax.fromTo(F,.15,{backgroundPosition:"0 -"+D*I+"px"},{backgroundPosition:"-"+S*(M-1)+"px -"+D*I+"px",ease:z}));TweenMax.set(F,{backgroundPosition:"0 0"})}x.on("mouseenter",function(){if(!(k.hasClass("choice-1-active")||k.hasClass("choice-2-active")||k.hasClass("choice-3-active")||k.hasClass("choice-4-active")||k.hasClass("choice-5-active"))){var e=$(this).parents("li").index();A[e].play()}}).on("mouseout",function(){var e=$(this).parents("li").index();A[e].reverse()})}if($(".choices").length&&x.click(function(e){if(m>767){if(e.preventDefault(),$(this).closest(".choices").hasClass("choice-"+($(this).closest("li").index()+1)+"-active")){var a=$(this).closest(".choices");a.removeClass("choice-1-active choice-2-active choice-3-active choice-4-active choice-5-active"),setTimeout(function(){a.removeClass("choice-1-animating choice-2-animating choice-3-animating choice-4-animating choice-5-animating")},v)}else{var a=$(this).closest(".choices");a.removeClass("choice-1-active choice-2-active choice-3-active choice-4-active choice-5-active"),$(this).closest(".choices").addClass("choice-"+($(this).closest("li").index()+1)+"-active choice-"+($(this).closest("li").index()+1)+"-animating")}if(1150>=m){$(".choices li").each(function(e,a){$(".zone-content",t).slideUp(300)});var t=$(this).closest("li");$(".zone-content",t).slideToggle(300)}else{var n=$(this).parents("li").index();A[n].reverse()}}}),$(".btn-close-choice").click(function(e){e.preventDefault();var a=$(this).closest(".choices");if(a.removeClass("choice-1-active choice-2-active choice-3-active choice-4-active choice-5-active"),setTimeout(function(){a.removeClass("choice-1-animating choice-2-animating choice-3-animating choice-4-animating choice-5-animating")},v),1150>=m){var t=$(this).closest("li");$(".zone-content",t).slideToggle(300)}}),$("#logo").on("click",function(e){e.preventDefault(),m>1280?C.toggleClass("sidebar-links-open"):C.hasClass("sidebar-links-open")||C.hasClass("nav-header-open")?C.hasClass("sidebar-links-open")?C.removeClass("sidebar-links-open").addClass("nav-header-open"):C.removeClass("nav-header-open").addClass("sidebar-links-open"):C.addClass("nav-header-open")}),$("#mask").on("click",function(e){e.preventDefault(),C.removeClass("nav-header-open sidebar-links-open sidebar-account-open sidebar-tools-open")}),$("#btn-close-sidebar-links").click(function(e){e.preventDefault(),m>1280?C.removeClass("sidebar-links-open"):C.removeClass("sidebar-links-open").addClass("nav-header-open")}),$("#btn-close-nav-header").click(function(e){e.preventDefault(),C.removeClass("nav-header-open")}),$("#btn-close-header-responsive").click(function(e){e.preventDefault(),C.hasClass("nav-header-open")?C.removeClass("nav-header-open"):C.hasClass("sidebar-links-open")?C.removeClass("sidebar-links-open").addClass("nav-header-open"):C.hasClass("sidebar-account-open")?C.removeClass("sidebar-account-open").addClass("nav-header-open"):C.hasClass("sidebar-tools-open")&&C.removeClass("sidebar-tools-open").addClass("nav-header-open")}),$("#btn-account").on("click",function(e){e.preventDefault(),C.toggleClass("sidebar-account-open"),1280>=m&&C.removeClass("nav-header-open")}),$("#btn-close-sidebar-account").click(function(e){e.preventDefault(),C.removeClass("sidebar-account-open"),1280>=m&&C.addClass("nav-header-open")}),$("#btn-tools").on("click",function(e){e.preventDefault(),C.toggleClass("sidebar-tools-open"),1280>=m&&C.removeClass("nav-header-open")}),$("#btn-close-sidebar-tools").click(function(e){e.preventDefault(),C.removeClass("sidebar-tools-open"),1280>=m&&C.addClass("nav-header-open")}),$(".btn-heart").on("click",function(e){e.preventDefault(),$(this).hasClass("on")?$(this).removeClass("on"):$(this).addClass("on")}),n(),$("#mapForm").length&&m>767&&(u||t()),$("#content-block-graph").length&&$("#content-block-graph").highcharts({chart:{polar:!0,type:"area",backgroundColor:null},title:{text:null},pane:{size:"100%"},plotOptions:{area:{marker:{enabled:!1}},series:{states:{hover:{enabled:!1}}}},xAxis:{categories:["Projet","Porteur de projet","Moyens"],tickmarkPlacement:"on",lineWidth:0,labels:{useHTML:!0,style:{color:"#878787",fontFamily:'"robotoitalic" ,"robotoregular", sans-serif',fontSize:"1em"}}},yAxis:{gridLineInterpolation:"polygon",lineWidth:0,min:0,max:10,tickInterval:2,labels:{enabled:!1}},tooltip:{shared:!0,pointFormat:'<span class="tooltip-graph">{point.y:,.0f}</span>',enabled:!1},legend:{enabled:!1},series:[{name:"Valeurs",data:[4,0,10],pointPlacement:"on",color:{radialGradient:{cx:0,cy:0,r:1},stops:[[0,"#b55543"],[1,"#ddae4b"]]},fillOpacity:1}],credits:{enabled:!1}}),$(".menu-popup a.btn-cancel").on("click",function(e){e.preventDefault(),s()}),$(".bg-popup").on("click",function(e){e.preventDefault(),s()}),$(".block-optionnal").length){var I=0,P=$(".block-optionnal"),j=P.length;for(I;j>I;I++){var E=P.eq(I),B=$("#"+E.attr("data-name"));B.on("change",function(e){$(this).prop("checked")?E.addClass("hidden"):E.removeClass("hidden")})}}$("#editForm").on("click",function(e){var a=$("#formToEdit"),t,n=$(this);e.preventDefault(),a.length&&(a.toggleClass("form-disabled").find("input").toggleAttr("disabled"),a.find("button[type=submit]").toggleClass("hidden"),a.hasClass("form-disabled")?n.html(n.attr("data-edit")):n.html(n.attr("data-cancel")),n.toggleClass("btn-pen").toggleClass("btn-cancel").blur(),a.find(".not-filled").length&&a.find(".not-filled").toggleClass("hidden"),a.find(".block-pwd").length&&(t=a.find(".block-pwd"),t.toggleClass("hidden").find("input").toggleAttr("disabled"),t.find("button").toggleClass("hidden"),a.find(".block-pwd2").length&&a.find(".block-pwd2").toggleClass("hidden")),a.siblings(".content-footer").length&&a.siblings(".content-footer").toggleClass("hidden"),a.find("textarea")&&a.find("textarea").toggleAttr("disabled"))}),$("#editPwd").on("click",function(e){e.preventDefault();var a,t=$(this);t.parents(".block-pwd").length&&(a=$(this).parents(".block-pwd"),a.find("input").toggleAttr("disabled"),a.find("input").attr("disabled")?t.html(t.attr("data-edit")):t.html(t.attr("data-cancel")),t.toggleClass("btn-pen").toggleClass("btn-cancel").blur(),a.find(".block-pwd2").length&&a.find(".block-pwd2").toggleClass("hidden"))}),$(".wrapper-btn-q-a .btn-q-a.action").on("click",function(e){if(e.preventDefault(),$(this).hasClass("valid")||$(this).hasClass("invalid")){if($(this).hasClass("invalid")){var a=$(this),t=$(this).parents(".wrapper-btn-q-a").find(".btn-q-a.action:not(.invalid)");a.removeClass("invalid").addClass("valid"),t.removeClass("valid").addClass("invalid")}}else $(this).addClass("valid"),$(this).parents(".wrapper-btn-q-a").find(".btn-q-a.action:not(.valid)").addClass("invalid");var n=$(this).parents("li").index();if($(this).parents(".wrapper-q-a").hasClass("opened")){var i=$(this).parents(".wrapper-q-a").next(".wrapper-q-a"),s=new TimelineMax;s.to($(".wrapper-btn-q-a",i).not(":eq("+n+")"),.2,{opacity:0}),s.set($(".wrapper-btn-q-a",i).not(":eq("+n+")"),{display:"none"}),s.set($(".wrapper-btn-q-a:eq("+n+")",i),{display:"block"}),s.to($(".wrapper-btn-q-a:eq("+n+")",i),.2,{opacity:1})}else{var i=$(this).parents(".wrapper-q-a").next(".wrapper-q-a");TweenMax.set($(".wrapper-btn-q-a:eq("+n+")",i),{display:"block"})}$(this).parents(".wrapper-q-a").hasClass("visible")&&TweenMax.to($(this).parents(".wrapper-q-a"),.2,{y:"0"}),TweenMax.to($(this).parents(".wrapper-q-a").next(".wrapper-q-a"),.2,{display:"block",opacity:1}),$(this).parents(".wrapper-q-a").addClass("opened")}),isBlocked&&$(".wrapper-pub").addClass("hidden"),a(),$(document).scroll(function(){g=$(document).scrollTop(),$(window).width()>979?g+$(window).height()==$(document).height()?$(".social-footer").hasClass("closed")&&TweenMax.set($(".social-footer"),{className:"-=closed"}):$(".social-footer").hasClass("closed")||TweenMax.set($(".social-footer"),{className:"+=closed"}):TweenMax.set($(".social-footer"),{className:"-=closed"})});var H=new Hammer(document.getElementById("sidebar-links"));H.on("swipeleft",function(e){1280>=m&&(C.hasClass("sidebar-links-open")||C.hasClass("nav-header-open")?C.hasClass("sidebar-links-open")?C.removeClass("sidebar-links-open").addClass("nav-header-open"):C.removeClass("nav-header-open").addClass("sidebar-links-open"):C.addClass("nav-header-open"))});var N=new Hammer(document.getElementById("nav-header"));if(N.on("swiperight",function(e){1280>=m&&(C.hasClass("sidebar-links-open")||C.hasClass("nav-header-open")?C.hasClass("sidebar-links-open")?C.removeClass("sidebar-links-open").addClass("nav-header-open"):C.removeClass("nav-header-open").addClass("sidebar-links-open"):C.addClass("nav-header-open"))}),$(window).resize(function(){var e=$(window).height(),a=$(window).width();a!=m&&(C.removeClass("sidebar-links-open sidebar-account-open nav-header-open sidebar-tools-open"),$(".choices").length&&k.removeClass("choice-1-active choice-2-active choice-3-active choice-4-active choice-5-active choice-1-animating choice-2-animating choice-4-animating choice-5-animating").find(".zone-content").attr("style",""),$("#header nav").length&&$("#header nav").addClass("no-transition"),$("#sidebar-account").length&&$("#sidebar-account").addClass("no-transition"),$("#sidebar-tools").length&&$("#sidebar-tools").addClass("no-transition"),$("#sidebar-links").length&&$("#sidebar-links").addClass("no-transition"),$(".bg-sidebar").length&&$(".bg-sidebar").addClass("no-transition"),clearTimeout(b),b=setTimeout(o,100)),f=e,m=a,n(),$("#mapForm").length&&m>767&&(u||t()),$("#toSlide").length>0&&($("#toSlide li").each(function(e,a){$(this).css("left",e*$(this).width())}),c()),$("#lb").length>0&&($(".lightbox-content ul li").each(function(e,a){$(this).css("left",e*$(this).width()-1)}),c()),i()}),$(window).load(function(){i(),$(".dashboard-block").length&&$(".dashboard-block").each(function(){0==$(this).position().left?$(this).addClass("align-left"):$(this).addClass("align-right")})}),$("#toSlide").length>0){$("#toSlide").prepend('<button class="prev-slide small" />'),$("#toSlide").append('<button class="next-slide small" />'),$("#toSlide li").each(function(e,a){$(this).css("left",e*$(this).width()-1)}),l(),$(".prev-slide").click(function(e){w--,l(),c()}),$(".next-slide").click(function(e){w++,l(),c()});var G=new Hammer(document.getElementById("toSlide"));G.on("swipeleft",function(e){w<$("#toSlide li").length-1&&(w++,l(),c())}),G.on("swiperight",function(e){w>0&&(w--,l(),c())}),$("#toSlide li a").on("click",function(e){e.preventDefault(),d($(this).attr("href"),!0,"#toSlide")})}if($(".open-lighbox").on("click",function(e){e.preventDefault(),d($(this).attr("href"),!1,"")}),$(".select-circle").length>0&&($(".select-circle .circle-step > li").each(function(e,a){$("input[type=checkbox]",this).prop("checked")||($(this).addClass("closed"),$(".content-circle-step",this).slideToggle(0))}),$(".select-circle .circle-step > li header").on("click",function(e){$("#formToEdit").hasClass("form-disabled")||(e.preventDefault(),$("input[type=checkbox]",this).prop("checked")?($("input[type=checkbox]",this).prop("checked",!1),$(this).parent().addClass("closed")):($("input[type=checkbox]",this).prop("checked",!0),$(this).parent().removeClass("closed")),$(this).next(".content-circle-step").slideToggle(400))})),"undefined"!=typeof google&&$("body").hasClass("hasMaps")&&window.matchMedia("screen").matches){var O=$("#latitude"),R=$("#longitude"),W=new google.maps.Geocoder,_=new google.maps.LatLng($("#map-canvas").attr("data-latIni"),$("#map-canvas").attr("data-longIni")),K={zoom:9,center:_},Q=new google.maps.Map(document.getElementById("map-canvas"),K),U,V=document.getElementById("geolocalisation"),J=new google.maps.places.Autocomplete(V);if(J.bindTo("bounds",Q),google.maps.event.addListener(J,"place_changed",function(){var e=J.getPlace();if(e.geometry){var a=e.geometry.location.lat(),t=e.geometry.location.lng(),n=new google.maps.LatLng(a,t);O.val(a),R.val(t),h(n),Q.setCenter(n)}}),"edit"==$("#map-canvas").attr("data-mode")&&google.maps.event.addListener(Q,"click",function(e){var a=e.latLng.lat(),t=e.latLng.lng(),n=new google.maps.LatLng(a,t);O.val(a),R.val(t),h(n),p(n)}),void 0!=$("#map-canvas").attr("data-pinLat")&&void 0!=$("#map-canvas").attr("data-pinLong")){var X=new google.maps.LatLng($("#map-canvas").attr("data-pinLat"),$("#map-canvas").attr("data-pinLong"));h(X)}}});